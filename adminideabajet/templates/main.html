{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Idea Bajet 2027 - Unified</title>
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>

<header class="header">
  <div class="header-text" style="display: flex; justify-content: space-between; align-items: center;">
    <h2><b>Idea Bajet 2027</b></h2>
    <form method="post" action="{% url 'logout' %}">
      {% csrf_token %}
      <button type="submit" class="btn-create logout-btn" style="background:#e74c3c;">Logout</button>
    </form>
  </div>
</header>

<div class="container">
  <div class="sidebar">
    <ul>
      <li><a href="#" onclick="showSection('dashboard')" class="nav-link" data-section="dashboard">DASHBOARD</a></li>
      <li><a href="#" onclick="showSection('aset')" class="nav-link" data-section="aset">ASET</a></li>
      <li><a href="#" onclick="showSection('lokasi')" class="nav-link" data-section="lokasi">LOKASI</a></li>
      <li><a href="#" onclick="showSection('e1')" class="nav-link" data-section="e1">ELEMEN 1: IPOH BANDAR TERBERSIH</a></li>
      <li><a href="#" onclick="showSection('e2')" class="nav-link" data-section="e2">ELEMEN 2: KEMUDAHAN AWAM DAN TAMAN</a></li>
      <li><a href="#" onclick="showSection('e3')" class="nav-link" data-section="e3">ELEMEN 3: KEMUDAHAN INFRASTRUKTUR</a></li>
      <li><a href="#" onclick="showSection('e4')" class="nav-link" data-section="e4">ELEMEN 4: BANGUNAN DAN HARTANAH MAJLIS</a></li>
      <li><a href="#" onclick="showSection('e5')" class="nav-link" data-section="e5">ELEMEN 5: HARTA MODAL (ASET)</a></li>
      <li><a href="#" onclick="showSection('e6')" class="nav-link" data-section="e6">ELEMEN 6: IPOH BANDAR (BANDAR PINTAR)</a></li>
      <li><a href="#" onclick="showSection('e7')" class="nav-link" data-section="e7">ELEMEN 7: IPOH BANDAR (BANDAR RENDAH KARBON)</a></li>
      <li><a href="#" onclick="showSection('e8')" class="nav-link" data-section="e8">ELEMEN 8: PEMBANGUNAN EKONOMI MASYARAKAT DAN PELANCONGAN</a></li>
    </ul>
  </div>

  <div class="main-content">
    <!-- Dashboard Section -->
    <div id="dashboard" class="content-section active">
      <h2>Dashboard</h2>
      <p>Welcome to Idea Bajet 2027 Management System</p>
    </div>

    <!-- Aset Section -->
    <div id="aset" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('aset')">Create</button>
      </div>
      <form id="createForm-aset" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="aset" placeholder="Tambah Aset Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Aset</th>
          <th>Action</th>
        </tr>
        {% for item in aset_data %}
        <tr id="row-aset-{{ item.asetid }}">
          <td id="aset-{{ item.asetid }}">{{ item.aset }}</td>
          <td id="action-aset-{{ item.asetid }}">
            <button class="btn-create" onclick="editRow('aset', {{ item.asetid }}, '{{ item.aset|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_aset' item.asetid %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- Lokasi Section -->
    <div id="lokasi" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('lokasi')">Create</button>
      </div>
      <form id="createForm-lokasi" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="list_lokasi" placeholder="Tambah Lokasi Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Lokasi</th>
          <th>Action</th>
        </tr>
        {% for item in lokasi_data %}
        <tr id="row-lokasi-{{ item.lid }}">
          <td id="lokasi-{{ item.lid }}">{{ item.list_lokasi }}</td>
          <td id="action-lokasi-{{ item.lid }}">
            <button class="btn-create" onclick="editRow('lokasi', {{ item.lid }}, '{{ item.list_lokasi|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_lokasi' item.lid %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E1 Section -->
    <div id="e1" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e1')">Create</button>
      </div>
      <form id="createForm-e1" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e1" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 1: Ipoh Bandar Terbersih</th>
          <th>Action</th>
        </tr>
        {% for item in e1_data %}
        <tr id="row-e1-{{ item.e1id }}">
          <td id="e1-{{ item.e1id }}">{{ item.e1 }}</td>
          <td id="action-e1-{{ item.e1id }}">
            <button class="btn-create" onclick="editRow('e1', {{ item.e1id }}, '{{ item.e1|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e1' item.e1id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E2 Section -->
    <div id="e2" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e2')">Create</button>
      </div>
      <form id="createForm-e2" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e2" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 2: Kemudahan Awam dan Taman</th>
          <th>Action</th>
        </tr>
        {% for item in e2_data %}
        <tr id="row-e2-{{ item.e2id }}">
          <td id="e2-{{ item.e2id }}">{{ item.e2 }}</td>
          <td id="action-e2-{{ item.e2id }}">
            <button class="btn-create" onclick="editRow('e2', {{ item.e2id }}, '{{ item.e2|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e2' item.e2id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E3 Section -->
    <div id="e3" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e3')">Create</button>
      </div>
      <form id="createForm-e3" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e3" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 3: Kemudahan Infrastruktur</th>
          <th>Action</th>
        </tr>
        {% for item in e3_data %}
        <tr id="row-e3-{{ item.e3id }}">
          <td id="e3-{{ item.e3id }}">{{ item.e3 }}</td>
          <td id="action-e3-{{ item.e3id }}">
            <button class="btn-create" onclick="editRow('e3', {{ item.e3id }}, '{{ item.e3|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e3' item.e3id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E4 Section -->
    <div id="e4" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e4')">Create</button>
      </div>
      <form id="createForm-e4" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e4" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 4: Bangunan dan Hartanah Majlis</th>
          <th>Action</th>
        </tr>
        {% for item in e4_data %}
        <tr id="row-e4-{{ item.e4id }}">
          <td id="e4-{{ item.e4id }}">{{ item.e4 }}</td>
          <td id="action-e4-{{ item.e4id }}">
            <button class="btn-create" onclick="editRow('e4', {{ item.e4id }}, '{{ item.e4|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e4' item.e4id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E5 Section -->
    <div id="e5" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e5')">Create</button>
      </div>
      <form id="createForm-e5" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e5" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 5: Harta Modal (Aset)</th>
          <th>Action</th>
        </tr>
        {% for item in e5_data %}
        <tr id="row-e5-{{ item.e5id }}">
          <td id="e5-{{ item.e5id }}">{{ item.e5 }}</td>
          <td id="action-e5-{{ item.e5id }}">
            <button class="btn-create" onclick="editRow('e5', {{ item.e5id }}, '{{ item.e5|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e5' item.e5id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E6 Section -->
    <div id="e6" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e6')">Create</button>
      </div>
      <form id="createForm-e6" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e6" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 6: Ipoh Bandar (Bandar Pintar)</th>
          <th>Action</th>
        </tr>
        {% for item in e6_data %}
        <tr id="row-e6-{{ item.e6id }}">
          <td id="e6-{{ item.e6id }}">{{ item.e6 }}</td>
          <td id="action-e6-{{ item.e6id }}">
            <button class="btn-create" onclick="editRow('e6', {{ item.e6id }}, '{{ item.e6|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e6' item.e6id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E7 Section -->
    <div id="e7" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e7')">Create</button>
      </div>
      <form id="createForm-e7" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e7" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 7: Ipoh Bandar (Bandar Rendah Karbon)</th>
          <th>Action</th>
        </tr>
        {% for item in e7_data %}
        <tr id="row-e7-{{ item.e7id }}">
          <td id="e7-{{ item.e7id }}">{{ item.e7 }}</td>
          <td id="action-e7-{{ item.e7id }}">
            <button class="btn-create" onclick="editRow('e7', {{ item.e7id }}, '{{ item.e7|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e7' item.e7id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>

    <!-- E8 Section -->
    <div id="e8" class="content-section">
      <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
        <button class="btn-create" onclick="showForm('e8')">Create</button>
      </div>
      <form id="createForm-e8" class="create-form" method="post" style="display:none;">
        {% csrf_token %}
        <input type="text" name="e8" placeholder="Tambah Elemen Baharu" required>
        <button type="submit" class="btn-create">Save</button>
      </form>
      <table class="table table-bordered">
        <tr>
          <th>Senarai Elemen 8: Pembangunan Ekonomi Masyarakat dan Pelancongan</th>
          <th>Action</th>
        </tr>
        {% for item in e8_data %}
        <tr id="row-e8-{{ item.e8id }}">
          <td id="e8-{{ item.e8id }}">{{ item.e8 }}</td>
          <td id="action-e8-{{ item.e8id }}">
            <button class="btn-create" onclick="editRow('e8', {{ item.e8id }}, '{{ item.e8|escapejs }}')">Edit</button>
            <form method="post" action="{% url 'delete_e8' item.e8id %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">Tiada data.</td>
        </tr>
        {% endfor %}
      </table>
    </div>
  </div>
</div>

<script>
// Global variables for URLs
const urls = {
  edit: {
    aset: "{% url 'edit_aset' 0 %}",
    lokasi: "{% url 'edit_lokasi' 0 %}",
    e1: "{% url 'edit_e1' 0 %}",
    e2: "{% url 'edit_e2' 0 %}",
    e3: "{% url 'edit_e3' 0 %}",
    e4: "{% url 'edit_e4' 0 %}",
    e5: "{% url 'edit_e5' 0 %}",
    e6: "{% url 'edit_e6' 0 %}",
    e7: "{% url 'edit_e7' 0 %}",
    e8: "{% url 'edit_e8' 0 %}"
  },
  delete: {
    aset: "{% url 'delete_aset' 0 %}",
    lokasi: "{% url 'delete_lokasi' 0 %}",
    e1: "{% url 'delete_e1' 0 %}",
    e2: "{% url 'delete_e2' 0 %}",
    e3: "{% url 'delete_e3' 0 %}",
    e4: "{% url 'delete_e4' 0 %}",
    e5: "{% url 'delete_e5' 0 %}",
    e6: "{% url 'delete_e6' 0 %}",
    e7: "{% url 'delete_e7' 0 %}",
    e8: "{% url 'delete_e8' 0 %}"
  }
};

// Show specific section and update navigation
function showSection(sectionName) {
  // Hide all sections
  const sections = document.querySelectorAll('.content-section');
  sections.forEach(section => {
    section.classList.remove('active');
  });
  
  // Show selected section
  const selectedSection = document.getElementById(sectionName);
  if (selectedSection) {
    selectedSection.classList.add('active');
  }
  
  // Update navigation active state
  const navLinks = document.querySelectorAll('.nav-link');
  navLinks.forEach(link => {
    link.classList.remove('active');
  });
  
  const activeLink = document.querySelector(`[data-section="${sectionName}"]`);
  if (activeLink) {
    activeLink.classList.add('active');
  }
}

// Show create form for specific section
function showForm(sectionName) {
  const formId = `createForm-${sectionName}`;
  const form = document.getElementById(formId);
  if (form) {
    form.style.display = 'block';
  }
}

// Edit row function
function editRow(sectionName, id, value) {
  const editUrl = urls.edit[sectionName].replace('0', id);
  const cellId = `${sectionName}-${id}`;
  const actionId = `action-${sectionName}-${id}`;
  
  document.getElementById(cellId).innerHTML = `
    <form id="editForm-${sectionName}-${id}" method="post" action="${editUrl}" style="display:inline;">
      {% csrf_token %}
      <input type="text" name="${sectionName}" value="${value}" required>
    </form>
  `;
  
  document.getElementById(actionId).innerHTML = `
    <button type="submit" form="editForm-${sectionName}-${id}" class="btn-create">Save</button>
    <button type="button" class="btn-create" style="background:#e74c3c;" onclick="cancelEdit('${sectionName}', ${id}, '${value.replace(/'/g, "\\'")}')">Cancel</button>
  `;
}

// Cancel edit function
function cancelEdit(sectionName, id, value) {
  const deleteUrl = urls.delete[sectionName].replace('0', id);
  const cellId = `${sectionName}-${id}`;
  const actionId = `action-${sectionName}-${id}`;
  
  document.getElementById(cellId).textContent = value;
  document.getElementById(actionId).innerHTML = `
    <button class="btn-create" onclick="editRow('${sectionName}', ${id}, '${value.replace(/'/g, "\\'")}')">Edit</button>
    <form method="post" action="${deleteUrl}" style="display:inline;">
      {% csrf_token %}
      <button type="submit" class="btn-create" style="background:#e74c3c;">Delete</button>
    </form>
  `;
}

// Initialize with dashboard
document.addEventListener('DOMContentLoaded', function() {
  showSection('dashboard');
});
</script>

</body>
</html> 